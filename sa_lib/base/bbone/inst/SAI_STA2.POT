;read object texts
#DO READ_TEXT("SAGR_LANG/SAI_STA2.TXT")

@OBJ_IDENT
#LOOP_WITH I = 1 .. %NR_OF_FIELDS
  #IF %I <= %POINTER_STA #THEN #BLOCK  
    @FIELD_IDENT = %OBJECT_IDENTIFIER_'I'_NAME
    @OBJ_IDENT=%OBJ_IDENT+SUBSTR('ID'_PICTURE_FUNCTION_CONF:V'FIELD_IDENT',1,%OI_LENGTH'I')
  #BLOCK_END
  #ELSE #LOOP_EXIT
#LOOP_END

@UNIT_IDENT= SUBSTR('ID'_PICTURE_FUNCTION_CONF:VDATA_ACQUISITION_UNIT,1,10)

;command procedure for updating objects from the process
@C_SEARCH = FETCH(0,"C","BGU_UPDATE")
#IF C_SEARCH:VIU == -1 #THEN #BLOCK
  #CREATE BGU_UPDATE:C =LIST(-
       IU = 1,-
       MO = 1,-
       CM = FPI_STA2:VUPDATE_COMMENT,-
       IN = ("",-
             "#DO READ_TEXT(""SAGR_BBONE/BGU_UPDATE.TXT"")"))
#BLOCK_END

;define 1:1 scale for AI object if it does not exist
@X_SEARCH=FETCH(0,"X","1_1")
#IF X_SEARCH:VIU == -1 #THEN #BLOCK
  #CREATE 1_1:X = LIST(SA = 0)
#BLOCK_END

#CASE 'ID'_PICTURE_FUNCTION_CONF:VSTATION_TYPE
  #WHEN "ANSI" #BLOCK
    ;define 1/1000 scale for ANSI-AI object if it does not exist
    @X_SEARCH = FETCH(0,"X","BGU_1_1000")
    #IF X_SEARCH:VIU == -1 #THEN #BLOCK
      #CREATE BGU_1_1000:X = LIST(SA = 1, SC = (0,1000,0,1))
    #BLOCK_END

    ;create command procedure for AI to DB updating
    @C_SEARCH = FETCH(0,"C","BGU_AI2DB")
    #IF C_SEARCH:VIU == -1 #THEN #BLOCK
      #CREATE BGU_AI2DB:C =LIST(-
            IU = 1,-
            MO = 1,-
            CM = FPI_STA2:VAI2DB_COMMENT,-
          IN = ("@INDEX = %IX-100","#SET ''LN'':P''INDEX'' = LIST(DB=TRUNC(%AI),RT=%RT,RM=%RM,OS=%OS)"))
    #BLOCK_END

    ;create event channel for AI to DB updating command procedure
    @A_SEARCH = FETCH(0,"A","BGU_AI2DB")
    #IF A_SEARCH:VIU == -1 #THEN #BLOCK
      #CREATE BGU_AI2DB:A=LIST(-
   	    CM = FPI_STA2:VAI2DB_COMMENT,-
            OT = "C",-
            ON = "BGU_AI2DB")
    #BLOCK_END
  #BLOCK_END
  
  #WHEN "PROC" #BLOCK
    ;create event channel for 2 BIs to DB updating command procedure
    @A_SEARCH = FETCH(0,"A","BGU_2BI2DB")
    #IF A_SEARCH:VIU == -1 #THEN #BLOCK
      #CREATE BGU_2BI2DB:A = LIST(-
   	    CM = FPI_STA2:VBI22DB_COMMENT,-
            OT = "C",-
            ON = "BGU_2BI2DB")
    #BLOCK_END

    ;create command procedure 1 for 2 BIs to DB updating
    @C1_SEARCH = FETCH(0,"C","BGU_2BI2DB")    
    #IF C1_SEARCH:VIU == -1 #THEN #BLOCK
      #CREATE BGU_2BI2DB:C =LIST(-
            IU = 1,-
            MO = 1,-
            CM = FPI_STA2:VBI22DB_COMMENT,-
            IN = ("#IF %IX==110 OR %IX==111 OR %IX==130 #THEN #BLOCK",-
                  "  @IX1 = %IX",-
                  "  @IX2 = %IX-2",-
                  "#BLOCK_END",-
                  "#ELSE #BLOCK",-
                  "  @IX1 = %IX+2",-
                  "  @IX2 = %IX",-
                  "#BLOCK_END",-
                  "@OBJ1_STATUS = ''LN'':POS''IX1''",-
                  "@OBJ2_STATUS = ''LN'':POS''IX2''",-
                  "#IF %OBJ1_STATUS + %OBJ2_STATUS == 0 #THEN #BLOCK",-
                  "  @OBJ1_VALUE = ''LN'':POV''IX1''",-
                  "  @OBJ2_VALUE = ''LN'':POV''IX2''",-
                  "  #IF %OBJ1_VALUE <> %OBJ2_VALUE #THEN #EXEC BGU_SETDB:C (@LN=%LN,@IX=%IX,@RT=%RT,@RM=%RM,@OS=%OS)",-
                  "  #ELSE #EXEC_AFTER 2 BGU_SETDB:C (@LN=%LN,@IX=%IX,@RT=%RT,@RM=%RM,@OS=%OS)",-
                  "#BLOCK_END"))    
    #BLOCK_END

    ;create command procedure 2 for 2 BIs to DB updating
    @C2_SEARCH = FETCH(0,"C","BGU_SETDB")    
    #IF C2_SEARCH:VIU == -1 #THEN #BLOCK
      #CREATE BGU_SETDB:C =LIST(-
            IU = 1,-
            MO = 1,-
            CM = FPI_STA2:VBI22DB_COMMENT,-
   	    IN = ("@T0=PACK_TIME(YEAR,MONTH,DAY,0,0,0)",-
                  "",-
                  "#CASE %IX",-
                  "  #WHEN 110 #BLOCK",-
                  "    @IX1=%IX",-
                  "    @IX2=%IX-2",-
                  "    @IX3=10",-
                  "    @IX4=%IX-2",-
                  "  #BLOCK_END",-
                  "  #WHEN 108 #BLOCK",-
                  "    @IX1=%IX+2",-
                  "    @IX2=%IX",-
                  "    @IX3=10",-
                  "    @IX4=%IX+2",-
                  "  #BLOCK_END",-
                  "  #WHEN 111 #BLOCK",-
                  "    @IX1=%IX",-
                  "    @IX2=%IX-2",-
                  "    @IX3=11",-
                  "    @IX4=%IX-2",-
                  "  #BLOCK_END",-                 
                  "  #WHEN 109 #BLOCK",-
                  "    @IX1=%IX+2",-
                  "    @IX2=%IX",-
                  "    @IX3=11",-
                  "    @IX4=%IX+2",-
                  "  #BLOCK_END",-                 
                  "  #WHEN 130 #BLOCK",-
                  "    @IX1=%IX",-
                  "    @IX2=%IX-2",-
                  "    @IX3=30",-
                  "    @IX4=%IX-2",-
                  "  #BLOCK_END",-
                  "  #WHEN 128 #BLOCK",-
                  "    @IX1=%IX+2",-
                  "    @IX2=%IX",-
                  "    @IX3=30",-
                  "    @IX4=%IX+2",-
                  "  #BLOCK_END",-
                  "#CASE_END",-
                  "@VALUE = 2*''LN'':P''IX1''+''LN'':P''IX2''",-
                  "#IF (''LN'':PRT''IX''-%T0)+''LN'':PRM''IX''/1000 >= -",-
                  "    (''LN'':PRT''IX4''-%T0)+''LN'':PRM''IX4''/1000 -",-
                  "    #THEN #SET ''LN'':P''IX3'' = LIST(DB=ROUND(%VALUE),RT=%RT,RM=%RM,OS=%OS)"))
    #BLOCK_END
  #BLOCK_END
#CASE_END

#IF 'ID'_PICTURE_FUNCTION_CONF:VSTATION_TYPE == "IEC61850" #THEN #BLOCK
      @v_LN_OPC_Instances = vector
      @t_OPC_Prefix = ""
      @v_LLN0_Instance(1) = ""
      #if length('ID'_PICTURE_FUNCTION_CONF:VOPC_LN_INSTANCES) > 0 #then #block
              @v_LN_OPC_Instances = 'ID'_PICTURE_FUNCTION_CONF:VOPC_LN_INSTANCES
	      @t_OPC_Prefix = 'ID'_PICTURE_FUNCTION_CONF:VOPC_ITEM_PREFIX
	      @v_LLN0_Instance = pick(%v_LN_OPC_Instances,select(locate(%v_LN_OPC_Instances,"LLN0"),">0"))
      #block_end
#BLOCK_END
@IN(1..10) = ""

;initialize variables
@DX
@IU
@HE
@PF
@PT
@LD
@P_OBJ01
@P_OBJ02
@P_OBJ03
@P_OBJ04
@P_OBJ05
@P_OBJ06
@P_OBJ07
@P_OBJ08
@P_OBJ09
@P_OBJ10
@P_OBJ11
@P_OBJECTS = LIST()

 ;define CX - text
@APL_ID=APL:BNA
@CX="'APL_ID'"
;input object for local/remote -indication
;binary (single) indication

@LR_IS_DB = TRUE

#IF DATA_TYPE('ID'_PICTURE_FUNCTION_CONF:VIND_DOUBLE_BINARY) <> "NONE" #THEN -
   @LR_IS_DB = 'ID'_PICTURE_FUNCTION_CONF:VIND_DOUBLE_BINARY

 @RX(1) = "          "+%UNIT_IDENT+"FPASTAILRS" 
 @IN(1) = ""
  #IF 'ID'_PICTURE_FUNCTION_CONF:VSTATION_TYPE == "IEC61850" AND 'ID'_PICTURE_FUNCTION_CONF:VDEFINE_ITEM_NAME #THEN #BLOCK
     @RX(1) = SUBSTR(%RX(1),1,35) + "LLN0.Loc.stVal"
     @IN(1) = %t_OPC_Prefix + "." + %v_LLN0_Instance(1) + ".Loc.stVal"
  #BLOCK_END

#IF NOT %LR_IS_DB #THEN #BLOCK
  #CASE 'ID'_PICTURE_FUNCTION_CONF:VSTATION_TYPE
    #WHEN "SPA" #BLOCK
      @DX(1)    ="N7S"
      @HE(1)    = 1                                    ;history enable = yes
      @PF(1)    = "FORM5SAGR1"                         ;physical format for printout
      @LD(1)    = BIT_MASK(1)                          ;listing device = 1
    #BLOCK_END

    #WHEN "LON","LONMARK" #BLOCK
      @DX(1)    ="X7S"
      @HE(1)    = 1                                    ;history enable = yes
      @PF(1)    = "FORM5SAGR1"                         ;physical format for printout
      @LD(1)    = BIT_MASK(1)                          ;listing device = 1
    #BLOCK_END

    #WHEN "IEC101","IEC103", "ICCP" #BLOCK
      @DX(1)    ="C3"
      @HE(1)    = 1                                    ;history enable = yes
      @PF(1)    = "FORM5SAGR1"                         ;physical format for printout
      @LD(1)    = BIT_MASK(1)                          ;listing device = 1
    #BLOCK_END

    #WHEN "ANSI" #BLOCK
      @DX(1)    ="3"
      @HE(1)    = 1                                    ;history enable = yes
      @PF(1)    = "FORM5SAGR1"                         ;physical format for printout
      @LD(1)    = BIT_MASK(1)                          ;listing device = 1
    #BLOCK_END

    #WHEN "PROC" #BLOCK
      @DX(1)    ="O1"
      @HE(1)    = 1                                    ;history enable = yes
      @PF(1)    = "FORM5SAGR1"                         ;physical format for printout
      @LD(1)    = BIT_MASK(1)                          ;listing device = 1
    #BLOCK_END

    #WHEN "RTU" #BLOCK
      #IF 'ID'_PICTURE_FUNCTION_CONF:VEVENT_RECORDING #THEN #BLOCK
        @DX(1)  ="I7S"
        @HE(1)  = 0                                    ;history enable = no
        @PF(1)  = "DUMMY"                              ;physical format for printout
        @LD(1)  = 0                                    ;listing device = none
      #BLOCK_END

      #ELSE #BLOCK
        @DX(1)  ="I7S"
        @HE(1)  = 1                                    ;history enable = yes
        @PF(1)  = "FORM5SAGR1"                         ;physical format for printout
        @LD(1)  = BIT_MASK(1)                          ;listing device = 1
      #BLOCK_END
    #BLOCK_END

    #WHEN "RTU_E" #BLOCK
      #IF 'ID'_PICTURE_FUNCTION_CONF:VEVENT_RECORDING #THEN #BLOCK
        @DX(1)  ="R7S"
        @HE(1)  = 0                                    ;history enable = no
        @PF(1)  = "DUMMY"                              ;physical format for printout
        @LD(1)  = 0                                    ;listing device = none
      #BLOCK_END

      #ELSE #BLOCK
        @DX(1)  ="R7S"
        @HE(1)  = 1                                    ;history enable = yes
        @PF(1)  = "FORM5SAGR1"                         ;physical format for printout
        @LD(1)  = BIT_MASK(1)                          ;listing device = 1
      #BLOCK_END
    #BLOCK_END

    #WHEN "DNP_30" #BLOCK
      #IF 'ID'_PICTURE_FUNCTION_CONF:VEVENT_RECORDING #THEN #BLOCK
        @DX(1)  ="D3"
        @HE(1)  = 0                                    ;history enable = yes
        @PF(1)  = "DUMMY"                              ;physical format for printout
        @LD(1)  = 0                                    ;listing device = 1
      #BLOCK_END
      
      #ELSE #BLOCK
        @DX(1)  ="D3"
        @HE(1)  = 1                                    ;history enable = yes
        @PF(1)  = "FORM5SAGR1"                         ;physical format for printout
        @LD(1)  = BIT_MASK(1)                          ;listing device = 1
      #BLOCK_END
    #BLOCK_END

    #WHEN "MODBUS_RTU" #BLOCK
        @DX(1)  ="I7S"
        @HE(1)  = 1                                    ;history enable = yes
        @PF(1)  = "FORM5SAGR1"                         ;physical format for printout
        @LD(1)  = BIT_MASK(1)                          ;listing device = 1
    #BLOCK_END

    #WHEN "IEC61850" #BLOCK
      @DX(1)    ="E7S"
      @HE(1)    = 1                                    ;history enable = yes
      @PF(1)    = "FORM5SAGR1"                         ;physical format for printout
      @LD(1)    = BIT_MASK(1)                          ;listing device = 1
    #BLOCK_END
  #CASE_END
  #if %IN(1) == "..Loc.stVal" #THEN @IN(1) = ""
  #MODIFY P_OBJECTS:V = LIST(P_OBJ01 = LIST(-
          IX = 10,-                                    ;index = 10
          CX = %CX,-                                   ;Comment text
          PT = 3,-                                     ;process object type = BI
          DX = %DX(1),-                                ;directive text
          BI = 1,-                                     ;object value = 1
          OI = %OBJ_IDENT,-                            ;substation & bay name
          OX = FPI_STA2:VLR_SWITCH_IND,-               ;object text
          IU = 1,-                                     ;in use = yes
          SS = 1,-                                     ;switch state = manual
          EE = 1,-                                     ;event enable = yes
          HE = %HE(1),-                                ;history enable
          HA = 1,-                                     ;history activation = new value
          HF = 0,-                                     ;history at first update = no
          HL = BIT_MASK(15),-                          ;history log number = 15
          RC = 0,-                                     ;receipt = acknowledgement not required
          AB = 0,-                                     ;alarm blocking = no
          AC = 0,-                                     ;alarm class = disabled
          AG = 0,-                                     ;alarming value = 0
          AD = 0,-                                     ;alarm delay = 0
          PD = 0,-                                     ;picture device = none
          PI = "",-                                    ;alarm picture
          PF = %PF(1),-                                ;physical format for printout
          RI = 44,-                                    ;dynamic texts for printout
          PA = 1,-                                     ;printout activation = new value
          PU = 0,-                                     ;picture/ printout at first update = no
          LD = %LD(1),-                                ;listing device
          IN = %IN(1),-
          RX = %RX(1)))                                ;data acquisition unit and group information
#BLOCK_END

;double binary indication
#ELSE_IF %LR_IS_DB #THEN #BLOCK
;double binary object for station local/remote -indication
 #CASE 'ID'_PICTURE_FUNCTION_CONF:VSTATION_TYPE
  #WHEN "SPA" #BLOCK
    @DX(1)    ="N7D"
    @HE(1)    = 1                                      ;history enable = yes
    @PF(1)    = "FORM5SAGR1"                           ;physical format for printout
    @LD(1)    = BIT_MASK(1)                            ;listing device = 1
  #BLOCK_END

  #WHEN "LON","LONMARK" #BLOCK
    @DX(1)    ="X7D"
    @HE(1)    = 1                                      ;history enable = yes
    @PF(1)    = "FORM5SAGR1"                           ;physical format for printout
    @LD(1)    = BIT_MASK(1)                            ;listing device = 1
  #BLOCK_END

  #WHEN "IEC101","IEC103", "ICCP" #BLOCK
    @DX(1)    ="C12"
    @HE(1)    = 1                                      ;history enable = yes
    @PF(1)    = "FORM5SAGR1"                           ;physical format for printout
    @LD(1)    = BIT_MASK(1)                            ;listing device = 1
  #BLOCK_END

  #WHEN "ANSI" #BLOCK
    @DX(1)    ="12"
    @HE(1)    = 1                                      ;history enable = yes
    @PF(1)    = "FORM5SAGR1"                           ;physical format for printout
    @LD(1)    = BIT_MASK(1)                            ;listing device = 1
  #BLOCK_END

  #WHEN "PROC" #BLOCK
    @DX(1)    ="12"
    @HE(1)    = 1                                      ;history enable = yes
    @PF(1)    = "FORM5SAGR1"                           ;physical format for printout
    @LD(1)    = BIT_MASK(1)                            ;listing device = 1
  #BLOCK_END

  #WHEN "RTU" #BLOCK
    #IF 'ID'_PICTURE_FUNCTION_CONF:VEVENT_RECORDING #THEN #BLOCK
      @DX(1)    ="I7D"
      @HE(1)    = 0                                    ;history enable = no
      @PF(1)    = "DUMMY"                              ;physical format for printout
      @LD(1)    = 0                                    ;listing device = none
    #BLOCK_END

    #ELSE #BLOCK
      @DX(1)    ="I7D"
      @HE(1)    = 1                                    ;history enable = yes
      @PF(1)    = "FORM5SAGR1"                         ;physical format for printout
      @LD(1)    = BIT_MASK(1)                          ;listing device = 1
    #BLOCK_END
  #BLOCK_END

  #WHEN "RTU_E" #BLOCK
    #IF 'ID'_PICTURE_FUNCTION_CONF:VEVENT_RECORDING #THEN #BLOCK
      @DX(1)    ="R7D"
      @HE(1)    = 0                                    ;history enable = no
      @PF(1)    = "DUMMY"                              ;physical format for printout
      @LD(1)    = 0                                    ;listing device = none
    #BLOCK_END

    #ELSE #BLOCK
      @DX(1)    ="R7D"
      @HE(1)    = 1                                    ;history enable = yes
      @PF(1)    = "FORM5SAGR1"                         ;physical format for printout
      @LD(1)    = BIT_MASK(1)                          ;listing device = 1
    #BLOCK_END
  #BLOCK_END

  #WHEN "DNP_30" #BLOCK
    #IF 'ID'_PICTURE_FUNCTION_CONF:VEVENT_RECORDING #THEN #BLOCK  
      @DX(1)    ="D12"
      @HE(1)    = 0                                    ;history enable = yes
      @PF(1)    = "DUMMY"                              ;physical format for printout
      @LD(1)    = 0                                    ;listing device = 1
    #BLOCK_END
    #ELSE #BLOCK  
      @DX(1)    ="D12"
      @HE(1)    = 1                                    ;history enable = yes
      @PF(1)    = "FORM5SAGR1"                         ;physical format for printout
      @LD(1)    = BIT_MASK(1)                          ;listing device = 1
    #BLOCK_END
  #BLOCK_END

  #WHEN "MODBUS_RTU" #BLOCK
      @DX(1)    ="I7D"
      @HE(1)    = 1                                    ;history enable = yes
      @PF(1)    = "FORM5SAGR1"                         ;physical format for printout
      @LD(1)    = BIT_MASK(1)                          ;listing device = 1
  #BLOCK_END

  #WHEN "IEC61850" #BLOCK
    @DX(1)    ="E7D"
    @HE(1)    = 1                                      ;history enable = yes
    @PF(1)    = "FORM5SAGR1"                           ;physical format for printout
    @LD(1)    = BIT_MASK(1)                            ;listing device = 1
  #BLOCK_END
 #CASE_END


 ;default value for station local/remote-switch
 #IF NOT 'ID'_PICTURE_FUNCTION_CONF:VSTATION_LR_IN_USE #THEN @DB=3
 #ELSE @DB=2

 #MODIFY P_OBJECTS:V = LIST(P_OBJ01 = LIST(-
          IX = 10,-                                    ;index = 10
          CX = %CX,-                                   ;comment text
          PT = 12,-                                    ;process object type = DB
          DX = %DX(1),-                                ;directive text
          DB = %DB,-                                   ;object value = 2 or 3
          NV = 4,-                                     ;normal value = none
          OI = %OBJ_IDENT,-                            ;substation name
          OX = FPI_STA2:VLR_SWITCH_IND,-               ;object text
          IU = 1,-                                     ;in use = yes
          SS = 1,-                                     ;switch state = manual
          EE = 1,-                                     ;event enable = yes
          HE = %HE(1),-                                ;history enable
          HA = 1,-                                     ;history activation = new value
          HF = 0,-                                     ;history at first update = no
          HL = BIT_MASK(15),-                          ;history log number = 15
          RC = 0,-                                     ;receipt = acknowledgement not required
          AB = 0,-                                     ;alarm blocking = no
          AC = 0,-                                     ;alarm class = disabled
          LA = 0,-                                     ;alarm activation = none
          AD = 0,-                                     ;alarm delay = 0
          PD = 0,-                                     ;picture device = none
          PI = "",-                                    ;alarm picture
          PF = %PF(1),-                                ;physical format for printout
          RI = 1,-                                     ;dynamic texts for printout
          PA = 1,-                                     ;printout activation = new value
          PU = 0,-                                     ;picture/ printout at first update = no
          LD = %LD(1),-                                ;listing device
          RX = %RX(1)))                                ;data acquisition unit and group information

#BLOCK_END

;output object for local/remote-switch command
#IF 'ID'_PICTURE_FUNCTION_CONF:VLR_REMOTELY_CONTROLLABLE #THEN #BLOCK
  #CASE 'ID'_PICTURE_FUNCTION_CONF:VSTATION_TYPE
    #WHEN "SPA" #BLOCK
      @DX(2..5)    ="N1"
      @IU(2..5)    = 0
      @IU(3..4)    = 1
      @PT(2..5)    = 5 
    #BLOCK_END

    #WHEN "LON","LONMARK" #BLOCK
      @DX(2..5)    ="X1"
      @IU(2..5)    = 0
      @IU(3..4)    = 1
      @PT(2..5)    = 5 
    #BLOCK_END

    #WHEN "IEC101","IEC103", "ICCP" #BLOCK
      @DX(2..5)    ="C5"
      @IU(2..5)    = 0
      @IU(3..4)    = 1
      @PT(2..5)    = 5 
    #BLOCK_END

    #WHEN "ANSI" #BLOCK
      @DX(2..5)    ="5"
      @IU(2..5)    = 0
      @IU(3..4)    = 1
      @PT(2..5)    = 5 
    #BLOCK_END

    #WHEN "PROC" #BLOCK
      @DX(2..5)    ="O7"
      @IU(2..5)    = 0
      @IU(3..4)    = 1
      @PT(2..5)    = 7 
    #BLOCK_END

    #WHEN "RTU" #BLOCK
      @DX(2..5)    ="I1"
      @IU(2..5)    = 0
      @IU(3..4)    = 1
      @PT(2..5)    = 5 
    #BLOCK_END

    #WHEN "RTU_E" #BLOCK
      @DX(2..5)    ="R1"
      @IU(2..5)    = 0
      @IU(3..4)    = 1
      @PT(2..5)    = 5 
    #BLOCK_END

    #WHEN "DNP_30" #BLOCK
      @DX(2..5)    ="D5"
      @IU(2..5)    = 0
      @IU(3..4)    = 1
      @PT(2..5)    = 5 
      #IF 'ID'_PICTURE_FUNCTION_CONF:VOUTPUT_STATUS #THEN @DX(102..105)="D3T"
    #BLOCK_END

    #WHEN "MODBUS_RTU" #BLOCK
      @DX(2..5)    ="I1"
      @IU(2..5)    = 0
      @IU(3..4)    = 1
      @PT(2..5)    = 5 
    #BLOCK_END

    #WHEN "IEC61850" #BLOCK
      @DX(2..5)    ="E1"
      @IU(2..5)    = 0
      @IU(3..4)    = 1
      @PT(2..5)    = 5 
    #BLOCK_END

  #CASE_END

  #IF %LR_IS_DB #THEN #BLOCK
     @OX(2)   = FPI_STA2:VLR_LOCAL_CMD
     @OX(3)   = FPI_STA2:VLR_STATION_CMD
     @OX(4)   = FPI_STA2:VLR_REMOTE_CMD
     @OX(5)   = FPI_STA2:VLR_RESERVED_CMD
     @RI(2..5)= 1
     @I_LOOP_COUNT = 5
  #BLOCK_END
  #ELSE #BLOCK
     @OX(2) = "Station/Remote command"
     #IF DATA_TYPE(FPI_STA2:VsR_CMD) <> "NONE" #THEN @OX(2)= FPI_STA2:VsR_CMD
     @RI(2)= 58
     @IU(2) = 1
     @I_LOOP_COUNT = 2
  #BLOCK_END

  @RX(2..5) = "          "+%UNIT_IDENT+"FPASTACLRS" 
  #IF 'ID'_PICTURE_FUNCTION_CONF:VSTATION_TYPE == "IEC61850" #THEN #BLOCK
     #IF NOT %LR_IS_DB #THEN #BLOCK
        @RX(2..5) = SUBSTR(%RX(2..5),1,35) + "LLN0.Loc.ctlVal"
        @IN(2..5) = ""
     #BLOCK_END
  #BLOCK_END

  #LOOP_WITH I = 2 .. %I_LOOP_COUNT
    @P_OBJ0'I'_LIST = LIST(-
          IX = 9 + %I,-                                ;index = 11,12,13,14
          PT = %PT('I'),-                              ;process object type = BO (PROCOL=DO)
          DX = %DX('I'),-                              ;directive text
          OI = %OBJ_IDENT,-                            ;substation name
          OX = %OX('I'),-                              ;object text
          IU = %IU('I'),-                              ;in use
          SS = 2,-                                     ;switch state = auto
          EE = 1,-                                     ;event enable = yes
          HE = 1,-                                     ;history enable = yes
          HA = 2,-                                     ;history activation = update
          HF = 1,-                                     ;history at first update = yes
          HL = BIT_MASK(15),-                          ;history log number = 15
          PF = "FORM5SAGR1",-                          ;physical format for printout
          RI = %RI(%I),-                               ;dynamic texts for printout
          PA = 2,-                                     ;printout activation = update
          PU = 1,-                                     ;picture/ printout at first update = yes
          LD = BIT_MASK(1),-                           ;listing device = 1
          IN = %IN(%I),-
          RX = %RX(%I))                                ;data acquisition unit and group information

    #CASE 'ID'_PICTURE_FUNCTION_CONF:VSTATION_TYPE
      #WHEN "IEC101", "ICCP" #MODIFY P_OBJ0'I'_LIST:V = LIST(-
          TY = 45)                                     ;type identification (ASDU) 45 = single command, 46 = double command
      #WHEN "IEC103" #MODIFY P_OBJ0'I'_LIST:V = LIST(-
          TY = 0)                                      ;type identification (ASDU) 20 = general command
      #WHEN "DNP_30" #BLOCK 
      	  #IF 'ID'_PICTURE_FUNCTION_CONF:VOUTPUT_STATUS #THEN #BLOCK
          @TMP_INDEX = %I + 100 
	  @P_OBJ0'TMP_INDEX'_LIST = LIST(-
	  IX = 109 + %I,-                              ;index = 111,112,113,114
          PT = 3,-                                     ;process object type = BI (PROCOL=DO)
          DX = %DX(%I+100),-                           ;directive text
          OI = %OBJ_IDENT,-                            ;substation name
          OX = %OX('I'),-                              ;object text
          IU = 1,-                                     ;in use
          SS = 1,-                                     ;switch state = manual
          EE = 1,-                                     ;event enable = yes
          HE = 0,-                                     ;history enable = no
          HA = 2,-                                     ;history activation = update
          HF = 1,-                                     ;history at first update = yes
          HL = BIT_MASK(15),-                          ;history log number = 15
          PF = "FORM5SAGR1",-                          ;physical format for printout
          RI = 1,-                                     ;dynamic texts for printout
          PA = 2,-                                     ;printout activation = update
          PU = 1,-                                     ;picture/ printout at first update = yes
          LD = 0,-                           	       ;listing device = 0
          RX = %RX(%I))                                ;data acquisition unit and group information
          #IF 'ID'_PICTURE_FUNCTION_CONF:VOUTPUT_STATUS #THEN #MODIFY P_OBJECTS:V = LIST(P_OBJ0'TMP_INDEX'=%P_OBJ0'TMP_INDEX'_LIST)
	  #BLOCK_END
       #BLOCK_END
    #CASE_END
    #MODIFY P_OBJECTS:V = LIST(P_OBJ0'I'=%P_OBJ0'I'_LIST)
  #LOOP_END
#BLOCK_END

;station blockings
#CASE 'ID'_PICTURE_FUNCTION_CONF:VSTATION_TYPE
  #WHEN "SPA" #BLOCK
    @DX(6)="N6"
  #BLOCK_END

  #WHEN "LON","LONMARK" #BLOCK
    @DX(6)="X6"
  #BLOCK_END

  #WHEN "IEC101","IEC103", "ICCP" #BLOCK
    @DX(6)="C9"
  #BLOCK_END

  #WHEN "ANSI" #BLOCK
    @DX(6)="9"
  #BLOCK_END

  #WHEN "PROC" #BLOCK
    @DX(6)="O2"
  #BLOCK_END

  #WHEN "RTU" #BLOCK
    @DX(6)="I6"
  #BLOCK_END

  #WHEN "RTU_E" #BLOCK
    @DX(6)="R6"
  #BLOCK_END

  #WHEN "DNP_30" #BLOCK
    @DX(6)="D9"
  #BLOCK_END

  #WHEN "MODBUS_RTU" #BLOCK
    @DX(6)="I6"
  #BLOCK_END

  #WHEN "IEC61850" #BLOCK
    @DX(6)="E6"
  #BLOCK_END

#CASE_END

#MODIFY P_OBJECTS:V = LIST(P_OBJ06 = LIST(-
          IX = 15,-                                    ;index = 15
          PT = 9,-                                     ;process object type = AI
          DX = %DX(6),-                                ;directive text
          AI = 0,-                                     ;object value = 0
          OI = %OBJ_IDENT,-                            ;substation name
          OX = FPI_STA2:VBLOCKINGS,-                   ;object text
          IU = 1,-                                     ;in use = yes
          SS = 2,-                                     ;switch state = auto
          EE = 1,-                                     ;event enable = yes
          HE = 1,-                                     ;history enable = yes
          HA = 2,-                                     ;history activation = update
          HF = 1,-                                     ;history at first update = yes
          HL = BIT_MASK(15),-                          ;history log number = 15
          HI = 0,-                                     ;upper alarm limit = 0
          HW = 0,-                                     ;upper warning limit = 0
          LW = 0,-                                     ;lower warning limit = 0
          LI = 0,-                                     ;lower alarm limit = 0
          ST = "Blocking",-                            ;unit of value
          SN = "1_1",-                                 ;scale name
          SZ = 1,-                                     ;zone supervision = SCADA
          RC = 0,-                                     ;receipt = acknowledgement not required
          AB = 0,-                                     ;alarm blocking = no
          AC = 0,-                                     ;alarm class = disabled
          AD = 0,-                                     ;alarm delay = 0
          PD = 0,-                                     ;picture device = none
          PI = "",-                                    ;alarm picture
          PF = "FORM5SAGR1",-                          ;physical format for printout
          RI = 1,-                                     ;dynamic texts for printout
          PA = 2,-                                     ;printout activation = update
          PU = 1,-                                     ;picture/ printout at first update = yes
          LD = BIT_MASK(1),-                           ;listing device
          RX = "                    FPASTAXBLK"))      ;group information

;station object selection on monitor
#CASE 'ID'_PICTURE_FUNCTION_CONF:VSTATION_TYPE
  #WHEN "SPA" #BLOCK
    @DX(7)   ="N6"
  #BLOCK_END

  #WHEN "LON","LONMARK" #BLOCK
    @DX(7)   ="X6"
  #BLOCK_END

  #WHEN "IEC101","IEC103", "ICCP" #BLOCK
    @DX(7)   ="C9"
  #BLOCK_END

  #WHEN "ANSI" #BLOCK
    @DX(7)   ="9"
  #BLOCK_END

  #WHEN "PROC" #BLOCK
    @DX(7)   ="O2"
  #BLOCK_END

  #WHEN "RTU" #BLOCK
    @DX(7)   ="I6"
  #BLOCK_END

  #WHEN "RTU_E" #BLOCK
    @DX(7)   ="R6"
  #BLOCK_END

  #WHEN "DNP_30" #BLOCK
    @DX(7)   ="D9"
  #BLOCK_END

  #WHEN "MODBUS_RTU" #BLOCK
    @DX(7)   ="I6"
  #BLOCK_END

  #WHEN "IEC61850" #BLOCK
    @DX(7)   ="E6"
  #BLOCK_END

#CASE_END

#MODIFY P_OBJECTS:V = LIST(P_OBJ07 = LIST(-
          IX = 16,-                                    ;index = 16
          PT = 9,-                                     ;process object type = AI
          DX = %DX(7),-                                ;directive text
          AI = 0,-                                     ;object value = 0
          OI = %OBJ_IDENT,-                            ;substation name
          OX = FPI_STA2:VMONITOR_EVENT,-               ;object text
          IU = 1,-                                     ;in use = yes
          SS = 2,-                                     ;switch state = auto
          EE = 1,-                                     ;event enable = yes
          HE = 0,-                                     ;history enable = no
          HA = 2,-                                     ;history activation = update
          HF = 1,-                                     ;history at first update = yes
          HL = BIT_MASK(15),-                          ;history log number = 15
          HI = 0,-                                     ;upper alarm limit = 0
          HW = 0,-                                     ;upper warning limit = 0
          LW = 0,-                                     ;lower warning limit = 0
          LI = 0,-                                     ;lower alarm limit = 0
          ST = "Sessions",-                            ;unit of value
          SN = "1_1",-                                 ;scale name
          SZ = 1,-                                     ;zone supervision = SCADA
          RC = 0,-                                     ;receipt = acknowledgement not required
          AB = 0,-                                     ;alarm blocking = no
          AC = 0,-                                     ;alarm class = disabled
          AD = 0,-                                     ;alarm delay = 0
          PD = 0,-                                     ;picture device = none
          PI = "",-                                    ;alarm picture
          PF = "",-                                    ;physical format for printout
          RI = 0,-                                     ;dynamic texts for printout
          PA = 2,-                                     ;printout activation = update
          PU = 1,-                                     ;picture/ printout at first update = yes
          LD = 0,-                                     ;listing device = none
          RX = "                    FPASTAXMEV"))      ;group information

;analog input for station local/remote -indication (to update ANSI double binary)
#IF 'ID'_PICTURE_FUNCTION_CONF:VSTATION_TYPE=="ANSI" #THEN #BLOCK

  #MODIFY P_OBJECTS:V = LIST(P_OBJ08 = LIST(-
          IX = 110,-                                   ;index = 110
          PT = 9,-                                     ;process object type = AI
          DX = "9",-                                   ;directive text
          AI = 2,-                                     ;object value = 2
          OI = %OBJ_IDENT,-                            ;substation name
          OX = FPI_STA2:VLR_SWITCH_IND,-               ;object text
          IU = 1,-                                     ;in use = yes
          SS = 1,-                                     ;switch state = manual
          EE = 1,-                                     ;event enable = yes
          HE = 0,-                                     ;history enable = no
          HA = 0,-                                     ;history activation = alarm
          HF = 0,-                                     ;history at first update = no
          HL = BIT_MASK(15),-                          ;history log number = 15
          HI = 0,-                                     ;upper alarm limit = 0
          HW = 0,-                                     ;upper warning limit = 0
          LW = 0,-                                     ;lower warning limit = 0
          LI = 0,-                                     ;lower alarm limit = 0
          ST = "L/R-sw",-                              ;unit of value
          SN = "BGU_1_1000",-                          ;scale name
          SZ = 1,-                                     ;zone supervision = SCADA
          RC = 0,-                                     ;receipt = acknowledgement not required
          AB = 0,-                                     ;alarm blocking = no
          AC = 0,-                                     ;alarm class = disabled
          AD = 0,-                                     ;alarm delay = 0
          PD = 0,-                                     ;picture device = none
          PI = "",-                                    ;alarm picture
          PF = "",-                                    ;physical format for printout
          RI = 0,-                                     ;dynamic texts for printout
          PA = 0,-                                     ;printout activation = alarm
          PU = 0,-                                     ;picture/ printout at first update = no
          LD = 0,-                                     ;listing device = none
          AN = "BGU_AI2DB",-                           ;action name
          AE = 1,-                                     ;action enabled
          AA = 2,-                                     ;action activation = update
          AF = 1,-                                     ;action at first update = yes
          RX = "          "+%UNIT_IDENT+"FPASTAELRS")) ;data acquisition unit and group information
#BLOCK_END

;binary input for station local/remote -indication (PROCOL)
#IF 'ID'_PICTURE_FUNCTION_CONF:VSTATION_TYPE=="PROC" #THEN #BLOCK

  #MODIFY P_OBJECTS:V = LIST(P_OBJ08 = LIST(-
          IX = 110,-                                   ;index 110
          PT = 3,-                                     ;process object type = BI
          DX = "O1",-                                  ;directive text
          BI = 1,-                                     ;object value = 1
          OI = %OBJ_IDENT,-                            ;substation name
          OX = FPI_STA2:VREMOTE_IND,-                  ;object text
          IU = 1,-                                     ;in use = yes
          SS = 1,-                                     ;switch state = manual
          EE = 1,-                                     ;event enable = yes
          HE = 0,-                                     ;history disable
          HA = 1,-                                     ;history activation = new value
          HF = 0,-                                     ;history at first update = no
          HL = BIT_MASK(15),-                          ;history log number = 15
          RC = 0,-                                     ;receipt = acknowledgement not required
          AB = 0,-                                     ;alarm blocking = no
          AC = 0,-                                     ;alarm class = disabled
          AG = 0,-                                     ;alarming value = 0
          AD = 0,-                                     ;alarm delay = 0
          PD = 0,-                                     ;picture device = none
          PI = "",-                                    ;alarm picture
          PF = "",-                                    ;physical format for printout
          RI = 0,-                                     ;dynamic texts for printout
          PA = 1,-                                     ;printout activation = new value
          PU = 0,-                                     ;picture/ printout at first update = no
          LD = 0,-                                     ;listing device
          AN = "BGU_2BI2DB",-                          ;action name
          AE = 1,-                                     ;action enabled
          AA = 2,-                                     ;action activation = update
          AF = 1,-                                     ;action at first update = yes
          RX = "          "+%UNIT_IDENT+"FPASTAELRS")) ;data acquisition unit and group information

  #MODIFY P_OBJECTS:V = LIST(P_OBJ09 = LIST(-
          IX = 108,-                                   ;index 108
          PT = 3,-                                     ;process object type = BI
          DX = "O1",-                                  ;directive text
          BI = 0,-                                     ;object value = 0
          OI = %OBJ_IDENT,-                            ;substation name
          OX = FPI_STA2:VLOCAL_IND,-                   ;object text
          IU = 1,-                                     ;in use = yes
          SS = 1,-                                     ;switch state = manual
          EE = 1,-                                     ;event enable = yes
          HE = 0,-                                     ;history disable
          HA = 1,-                                     ;history activation = new value
          HF = 0,-                                     ;history at first update = no
          HL = BIT_MASK(15),-                          ;history log number = 15
          RC = 0,-                                     ;receipt = acknowledgement not required
          AB = 0,-                                     ;alarm blocking = no
          AC = 0,-                                     ;alarm class = disabled
          AG = 0,-                                     ;alarming value = 0
          AD = 0,-                                     ;alarm delay = 0
          PD = 0,-                                     ;picture device = none
          PI = "",-                                    ;alarm picture
          PF = "",-                                    ;physical format for printout
          RI = 0,-                                     ;dynamic texts for printout
          PA = 1,-                                     ;printout activation = new value
          PU = 0,-                                     ;picture/ printout at first update = no
          LD = 0,-                                     ;listing device
          AN = "BGU_2BI2DB",-                          ;action name
          AE = 1,-                                     ;action enabled
          AA = 2,-                                     ;action activation = update
          AF = 1,-                                     ;action at first update = yes
          RX = "          "+%UNIT_IDENT+"FPASTAELRS")) ;data acquisition unit and group information
#BLOCK_END

;event recording object for station local/remote -indication
#IF ('ID'_PICTURE_FUNCTION_CONF:VSTATION_TYPE=="RTU" OR -
'ID'_PICTURE_FUNCTION_CONF:VSTATION_TYPE=="RTU_E" OR 'ID'_PICTURE_FUNCTION_CONF:VSTATION_TYPE=="DNP_30") -
AND 'ID'_PICTURE_FUNCTION_CONF:VEVENT_RECORDING #THEN #BLOCK
  #CASE 'ID'_PICTURE_FUNCTION_CONF:VSTATION_TYPE
    #WHEN "RTU" #BLOCK
      @DX(8)    ="I10D"
    #BLOCK_END

    #WHEN "RTU_E" #BLOCK
      @DX(8)    ="R10D"
    #BLOCK_END

   #WHEN "DNP_30" #BLOCK
      @DX(8)    ="D12"
    #BLOCK_END
  #CASE_END

  #MODIFY P_OBJECTS:V = LIST(P_OBJ08 = LIST(-
          IX = 110,-                                   ;index = 110
          PT = 12,-                                    ;process object type = DB
          DX = %DX(8),-                                ;directive text
          NV = 4,-                                     ;normal value = none
          OI = %OBJ_IDENT,-                            ;substation name
          OX = FPI_STA2:VLR_SWITCH_IND,-               ;object text
          IU = 1,-                                     ;in use = yes
          SS = 1,-                                     ;switch state = manual
          EE = 1,-                                     ;event enable = yes
          HE = 1,-                                     ;history enable = yes
          HA = 2,-                                     ;history activation = update
          HF = 1,-                                     ;history at first update = yes
          HL = BIT_MASK(15),-                          ;history log number = 15
          RC = 0,-                                     ;receipt = acknowledgement not required
          AB = 0,-                                     ;alarm blocking = no
          AC = 0,-                                     ;alarm class = disabled
          LA = 0,-                                     ;alarm activation = none
          AD = 0,-                                     ;alarm delay = 0
          PD = 0,-                                     ;picture device = none
          PI = "",-                                    ;alarm picture
          PF = "FORM5SAGR1",-                          ;physical format for printout
          RI = 1,-                                     ;dynamic texts for printout
          PA = 2,-                                     ;printout activation = update
          PU = 1,-                                     ;picture/ printout at first update = yes
          LD = BIT_MASK(1),-                           ;listing device = 1
          RX = "          "+%UNIT_IDENT+"FPASTAELRS")) ;data acquisition unit and group information
#BLOCK_END

;command termination
#IF 'ID'_PICTURE_FUNCTION_CONF:VSTATION_TYPE=="IEC101" OR 'ID'_PICTURE_FUNCTION_CONF:VSTATION_TYPE=="IEC103" #THEN #BLOCK
  #IF 'ID'_PICTURE_FUNCTION_CONF:VLR_REMOTELY_CONTROLLABLE #THEN #BLOCK
    ;command termination for station local/remote-switch command
    @OX(8)  = FPI_STA2:VLR_LOCAL_CMD
    @OX(9)  = FPI_STA2:VLR_STATION_CMD
    @OX(10) = FPI_STA2:VLR_REMOTE_CMD
    @OX(11) = FPI_STA2:VLR_RESERVED_CMD

    #LOOP_WITH I = 8 .. 11
      #IF %I==8 #THEN @II="08"
      #ELSE_IF %I==9 #THEN @II="09"
      #ELSE @II=%I
      #MODIFY P_OBJECTS:V = LIST(P_OBJ'II' = LIST(-
            IX = 103 + %I,-                            ;index = 111,112,113,114
            PT = 9,-                                   ;process object type = AI
            DX = "C9E",-                               ;directive text
            OI = %OBJ_IDENT,-                          ;substation & bay name
            OX = %OX('I'),-                            ;object text
            IU = 1,-                                   ;in use = yes
            SS = 2,-                                   ;switch state = auto
            EE = 1,-                                   ;event enable = yes
            HE = 1,-                                   ;history enable
            HA = 2,-                                   ;history activation = update
            HF = 1,-                                   ;history at first update = yes
            HL = BIT_MASK(15),-                        ;history log number = 15
            HI = 0,-                                   ;upper alarm limit = 0
            HW = 0,-                                   ;upper warning limit = 0
            LW = 0,-                                   ;lower warning limit = 0
            LI = 0,-                                   ;lower alarm limit = 0
            ST = "cmd status",-                        ;unit of value
            SN = "1_1",-                               ;scale name
            SZ = 1,-                                   ;zone supervision = SCADA
            RC = 0,-                                   ;receipt = acknowledgement not required
            AB = 0,-                                   ;alarm blocking = no
            AC = 0,-                                   ;alarm class = 0
            AD = 0,-                                   ;alarm delay = 0
            PD = 0,-                                   ;picture device = none
            PI = "",-                                  ;alarm picture
            PF = "FORM5SAGR1",-                        ;physical format for printout
            RI = 10,-                                  ;dynamic texts for printout
            PA = 2,-                                   ;printout activation = update
            PU = 1,-                                   ;picture/ printout at first update = yes
            LD = BIT_MASK(1),-                         ;listing device
            RX = "          "+%UNIT_IDENT+"FPASTATLRS")) ;data acquisition unit and group information
    #LOOP_END
  #BLOCK_END
#BLOCK_END
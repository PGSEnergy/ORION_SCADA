; This command procedure is used for sending AI process object values
; from a COM application to a NCC (upstream direction)
;
; SYS600 10.2.0
; Compilation status: Compiled
; DO NOT edit this program without consulting with Hitachi Power Grids.
;
; INPUT:  @LN, @IX, @RT, @RM, @OS, @CA, @CT, from input process object
;         @COM_CAUSE_OF_TRANSMISSION, COT, given if executed manually at GI
;         @NCC_STA_NUMBERS , STA numbers of the NCCs, vector
;         @NCC_PROTOCOLS, protocols of the NCCs, vector
;         @NCC_ADDRESSES, addresses of the NCCs, vector
;         @NCC_BIT_ADDRESSES, bit addresses of the NCCs, vector
;         @SIGNAL_CLASSES, classes of the signals, vector
;         @SCALE_NAMES, names of the scales, vector
;         @ADDITIONAL_DATA, additional xref data, vector
;         @NCC_OPERATION_MODES, operation modes of the NCCs, vector   
;         @AL_GROUP_NUMBERS, alarm group numbers, vector
;         @AL_GROUP_BIT_NUMBERS, alarm group bit numbers, vector
;         @SIGNAL_HANDLING_ATTRS, datatype-specific special conditions, integer (bit mask)
;         @NCC_NUMBERS, numbers of the NCCs, vector 
;         APL:BSV(28), time stamps of the pending indications
;         APL:BSV(29), ids (ln+ix+sta_nr) of the pending indications
; OUTPUT  APL:BSV(28), time stamps of the pending indications
;         APL:BSV(29), ids (ln+ix+sta_nr) of the pending indications
;---------------------------------------------------------------------------------------------

#ERROR CONTINUE

;initialize variables
@CONNECTED_TO_COMMAND_FROM_STA = 0
@PREVENT_DATA_SENDING = FALSE
@INTERROGATED_OR_REQUESTED = FALSE
@IEC_TERM_ENABLED = COM_GENVAR:PBZ(2)
@ENABLE_LOGGING = COM_GENVAR:PBZ(3)
@ENABLE_DATA_SENDING_AFTER_STARTUP = COM_GENVAR:PBZ(4)
@UN = 'LN':PUN'IX'
@SX = 'LN':PSX'IX'
@INDICATION_BLOCKED = FALSE
@INDICATION_BLOCKED_ENABLED = COM_GENVAR:PBZ(16)
@RZ = 'LN':PRZ'IX'
@TRANSIENT_BIT = 0   ; Change if process device provides this information
@SCALE_NAME = "1_1"

;if newer registration found
#IF 'LN':PRT'IX' > %RT OR ('LN':PRT'IX' == %RT AND 'LN':PRM'IX' > %RM) #THEN #BLOCK
   #IF DATA_TYPE(%COM_CAUSE_OF_TRANSMISSION) == "INTEGER" #THEN #BLOCK
      #IF %COM_CAUSE_OF_TRANSMISSION >= 20 #THEN #BLOCK
         @PREVENT_DATA_SENDING = TRUE
         @UPDATE_SIGNAL_TIME = TIMES  
         @NOTIFY = CONSOLE_OUTPUT("'UPDATE_SIGNAL_TIME' The oldest update of signal 'LN':P'IX' is not sent to the NCCs")
      #BLOCK_END ; 2
      #ELSE #BLOCK
         @OS = 'LN':POS'IX'
         #IF %OS < 10 #THEN #BLOCK
            @AI = 'LN':POV'IX'
            @AL = 'LN':PAL'IX'
         #BLOCK_END
         #ELSE #BLOCK
            @AI = 0
            @AL = 1
         #BLOCK_END                    
         @RT = 'LN':PRT'IX'
         @RM = 'LN':PRM'IX'
         @BL = 'LN':PBL'IX'
         @SB = 'LN':PSB'IX'
         @OR = 'LN':POR'IX'
         @CT = 'LN':PCT'IX'
         @OG = 'LN':POG'IX'
      #BLOCK_END
   #BLOCK_END
#BLOCK_END ; 1
#IF NOT %PREVENT_DATA_SENDING AND %ENABLE_DATA_SENDING_AFTER_STARTUP #THEN #BLOCK ; 1
   ;read cross-reference table pointer
   @XREF_INDEX = 'LN':PTI'IX'
   ;if xref found, decode NCC addresses and group alarm information
   #IF %XREF_INDEX > 0  #THEN #BLOCK  ; 2
       #IF COM_USXREF:CCS == 1 #THEN #DO COM_USXREF:CCP
       #ELSE #DO COM_USXREF:CIN 
      ;if connected to a command, set flag and remove id and time from apl:bsv
      @ID = %LN + DEC(%IX,1)
      @TMP = SELECT(APL:BSV(29),"==""'ID'/*""","WILDCARDS")
      #IF LENGTH(%TMP) > 0 #THEN #BLOCK ; 2
         @IND_IDS = APL:BSV(29)
         @ID_VEC = SEPARATE(%IND_IDS(%TMP(1)),"/")
         @CONNECTED_TO_COMMAND_FROM_STA = DEC_SCAN(%ID_VEC(3))        
         @COMMAND_ADDRESS = DEC_SCAN(%ID_VEC(2))   
         @ORIGINATOR = DEC_SCAN(%ID_VEC(4))
         #SET APL:BSV(28) = DELETE_ELEMENT(APL:BSV(28),%TMP(1))
         #SET APL:BSV(29) = DELETE_ELEMENT(APL:BSV(29),%TMP(1))
      #BLOCK_END ; 2
      ;if NCC connections found, send value to NCCs and alarm to group alarm object
      #IF LENGTH(%NCC_STA_NUMBERS) > 0 #THEN #BLOCK ; 3
         ;if connected to a command, set COT to 11
         ;if no COT given, assume spontaneous COT
         #IF %CONNECTED_TO_COMMAND_FROM_STA <> 0 #THEN @COT = 11 + 256*%OG
         #ELSE_IF DATA_TYPE(%COM_CAUSE_OF_TRANSMISSION) == "INTEGER" #THEN #BLOCK
            @INTERROGATED_OR_REQUESTED = TRUE  
            @COT = %COM_CAUSE_OF_TRANSMISSION + 256*%OG
         #BLOCK_END   
         #ELSE @COT = 3 + 256*%OG
         #IF %INDICATION_BLOCKED_ENABLED #THEN #BLOCK
            #IF BIT(%RZ,3) == 1 #THEN #BLOCK
               #IF BIT(%RZ,8) == 0 AND DATA_TYPE(%COM_CAUSE_OF_TRANSMISSION) <> "INTEGER" #THEN #BLOCK 
                  @INDICATION_BLOCKED = TRUE
               #BLOCK_END
            #BLOCK_END
         #BLOCK_END
         #IF NOT %INDICATION_BLOCKED #THEN #BLOCK
            #LOOP_WITH NCC_COUNTER = 1..LENGTH(%NCC_STA_NUMBERS) ; 4
               ;cross-reference parameters
               @NCC_NUMBER = %NCC_NUMBERS(%NCC_COUNTER)      
               @STA_NR = %NCC_STA_NUMBERS(%NCC_COUNTER)
               @AL_GROUP = %AL_GROUP_NUMBERS(%NCC_COUNTER)
               @AL_BIT = %AL_GROUP_BIT_NUMBERS(%NCC_COUNTER)
               ;if  NCC address found, send value according to the NCC protocol
               ;check also that data sending is allowed by parameter set from tool
               #IF %NCC_ADDRESSES(%NCC_COUNTER) <> -1 AND NOT COM_GENVAR:PBZ(%NCC_NUMBER+4) #THEN #BLOCK ; 5
                  #CASE %NCC_PROTOCOLS(%NCC_COUNTER); 6
                     #WHEN 1 #BLOCK ;********************** RP-570 slave protocol *******************************************************************; 7 
                        #IF %SCALE_NAMES(%NCC_COUNTER) <> "" #THEN #block 
                           @SCALE_NAME = %SCALE_NAMES(%NCC_COUNTER)   
                           @i_Status = status
                           #error ignore
                              @VALUE = SCALE(%AI,%SCALE_NAME,"INPUT")                                             
                           #error continue
                           #if status <> 0 #then #block
                              @i_Console = console_output("COM 500 scale 'SCALE_NAME' object not found. The update of signal 'LN':P'IX' is not scaled")
                              @i_Status = status
                           #block_end
                        #block_end           
                        #ELSE @VALUE = %AI   
                        ;check status (valid/invalid)
                        #IF %OS == 0 #THEN @STATUS = 0 
                        #ELSE @STATUS = 7
                        #IF %INDICATION_BLOCKED_ENABLED #THEN #BLOCK
                           #IF BIT(%RZ,3) == 1 #THEN @STATUS = 7 
                        #BLOCK_END
                        #IF %OS == 3 #THEN @RP_TIME_QUALITY = 5
                        #ELSE @RP_TIME_QUALITY = 0 
                        ;if outside range, limit value
                        #IF ABS(%VALUE) > 2000 OR %OS <> 0 OR %OR==1 #THEN #BLOCK                        
                           @VALUE = ROUND(MIN(MAX(%VALUE,-2000),2000))
                           @LIMIT_INFO = 7
                           @STATUS = 7 
                        #BLOCK_END
                        #ELSE @LIMIT_INFO = 0   
                        ;**************** project-specific modifications ************************
                        #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),0) == 1 #THEN #BLOCK
                           ;write the project-specific code in this block
                        #BLOCK_END
                        ;send value to NET
                        #SET STA'STA_NR':SAV(%NCC_ADDRESSES(%NCC_COUNTER)) = (RTU_ATIME(%RT,%RM),ROUND(%VALUE),%STATUS)
                        ;send ERMx telegram if required
                        #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),1) == 1 AND NOT %INTERROGATED_OR_REQUESTED AND STA'STA_NR':SDI == 1 #THEN -                     
                        #SET STA'STA_NR':SEX(%NCC_ADDRESSES(%NCC_COUNTER)) = (33,RTU_ATIME(%RT,%RM),%RP_TIME_QUALITY,%LIMIT_INFO)                                           
                        #IF %ENABLE_LOGGING #THEN #BLOCK ; 8
                           @NCC_ADDR=%NCC_ADDRESSES(%NCC_COUNTER)
                           @SH=%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER)
                           @S=STATUS
                           @INFO="'rt':'rm',USAI,'UN','LN':P'IX','STA_NR',,'AI',RP570,'SH','NCC_ADDR','VALUE','LIMIT_INFO',,,,,,'status','S','OS',,'SX'"
                           #IF COM_LOG:CCS == 1 #THEN #DO COM_LOG:CCP
                           #ELSE #DO COM_LOG:CIN
                        #BLOCK_END ; 8                     
                     #BLOCK_END ; 7          
                     #WHEN 2 #BLOCK ;********************** IEC protocol ****************************************************************; 7
                        #IF %NCC_SUBPROTOCOLS(%NCC_COUNTER) == 2 #THEN #BLOCK ;ICCP
                           #IF %OS == 1 OR %OS == 10 #THEN @QUALIFIER = 4 
                           #ELSE_IF %OS == 2 #THEN @QUALIFIER = 3 
                           #ELSE @QUALIFIER = 1
                           #IF %OS == 1 OR %OS == 10 #THEN @OS_STATUS = 2
                           #ELSE_IF %OS == 3 #THEN @OS_STATUS = 1
                           #ELSE @OS_STATUS = 0
                           #IF %SCALE_NAMES(%NCC_COUNTER) <> "" #THEN #block 
                              @SCALE_NAME = %SCALE_NAMES(%NCC_COUNTER)   
                              @i_Status = status
                              #error ignore
                                 @VALUE = SCALE(%AI,%SCALE_NAME,"INPUT")                                             
                              #error continue
                              #if status <> 0 #then #block
                                 @VALUE = %AI
                                 @OS_STATUS = 2
                                 @i_Console = console_output("COM 500 scale 'SCALE_NAME' object not found. The update of signal 'LN':P'IX' is not scaled")
                                 @i_Status = status
                              #block_end
                           #block_end           
                           #ELSE @VALUE = %AI
                           #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),1) == 1 #THEN @VALUE = ROUND(%VALUE)  
                           ;**************** project-specific modifications *************************
                           #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),0) == 1 #THEN #BLOCK
                              ;write the project-specific code in this block
                           #BLOCK_END
                           #SET  STA'STA_NR':SDV(%NCC_ADDRESSES(%NCC_COUNTER))=(%VALUE,%QUALIFIER,0,%OS_STATUS,%RT,%RM)
                           #IF %ENABLE_LOGGING #THEN #BLOCK ; 8
                              @NCC_ADDR=%NCC_ADDRESSES(%NCC_COUNTER)
                              @NCC_TYPE=%NCC_SUBPROTOCOLS(%NCC_COUNTER)
                              @SH=%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER)
                              @S=STATUS
                              @INFO="'rt':'rm',USAI,'UN','LN':P'IX','STA_NR',,'AI',ICCP,'SH','NCC_ADDR','VALUE',,,,,,,'QUALIFIER','S','OS',,'SX'"
                              #IF COM_LOG:CCS == 1 #THEN #DO COM_LOG:CCP
                              #ELSE #DO COM_LOG:CIN
                           #BLOCK_END ; 8                                        
                        #BLOCK_END
                        #ELSE_IF %NCC_SUBPROTOCOLS(%NCC_COUNTER) == 3 #THEN #BLOCK ;IEC 61850 Server
                           @LOG_SEND_TERM = 0
                           #IF DATA_TYPE(%COM_CAUSE_OF_TRANSMISSION) == "INTEGER" #THEN @COT = %COM_CAUSE_OF_TRANSMISSION
                           #ELSE @COT = 3
                           #IF %OS == 1 OR %OS == 10 #THEN @VALIDITY = 1
                           #ELSE_IF %OS == 2 #THEN @VALIDITY = 3
                           #ELSE @VALIDITY = 0
                           @IEC_q =%QL 
                           #IF %SCALE_NAMES(%NCC_COUNTER) <> "" #THEN #block 
                              @SCALE_NAME = %SCALE_NAMES(%NCC_COUNTER)   
                              @i_Status = status
                              #error ignore
                                 @VALUE = SCALE(%AI,%SCALE_NAME,"INPUT")                                             
                              #error continue
                              #if status <> 0 #then #block
                                 @VALUE = %AI 
                                 @VALIDITY = 1
                                 @IEC_q = BIT_SET(%IEC_q,14)
                                 @IEC_q = BIT_CLEAR(%IEC_q,15)
                                 @i_Console = console_output("COM 500 scale 'SCALE_NAME' object not found. The update of signal 'LN':P'IX' is not scaled")
                                 @i_Status = status
                              #block_end
                           #block_end           
                           #ELSE @VALUE = %AI
                           #IF 'LN':PDX'IX'== "E6" #THEN #BLOCK
                              #IF %INTERROGATED_OR_REQUESTED #THEN @QUALIFIER = BIT(%IEC_q,8)+2*BIT(%IEC_q,9)+4*BIT(%IEC_q,10)+8*BIT(%IEC_q,11)+16*BIT(%IEC_q,12)+32*BIT(%IEC_q,13)+64*BIT(%VALIDITY,0)+128*BIT(%VALIDITY,1)-
                                                                        +2048*BIT(%IEC_q,3)+4096*BIT(%IEC_q,4)+8192*BIT(%IEC_q,5)+16384*BIT(%IEC_q,6)+32768*BIT(%IEC_q,7) 
                              #ELSE @QUALIFIER = BIT(%IEC_q,8)+2*BIT(%IEC_q,9)+4*BIT(%IEC_q,10)+8*BIT(%IEC_q,11)+16*BIT(%IEC_q,12)+32*BIT(%IEC_q,13)+64*BIT(%IEC_q,14)+128*BIT(%IEC_q,15)-
                                                                        +2048*BIT(%IEC_q,3)+4096*BIT(%IEC_q,4)+8192*BIT(%IEC_q,5)+16384*BIT(%IEC_q,6)+32768*BIT(%IEC_q,7) 
                           #BLOCK_END                           
                           #ELSE @QUALIFIER = 16*%OR+64*BIT(%VALIDITY,0)+128*BIT(%VALIDITY,1)+2048*%BL+8192*%SB 
                           @SOT = 10
                           #IF %OS == 3 #THEN @SOT =BIT_SET(%SOT,5) 
                           ;**************** project-specific modifications *************************
                           #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),0) == 1 #THEN #BLOCK
                              ;write the project-specific code in this block
                           #BLOCK_END
                           #SET STA'STA_NR':SDV = (%NCC_ADDRESSES(%NCC_COUNTER),%VALUE,%COT,%QUALIFIER,%SOT,%RT,%RM)
                           #IF %CONNECTED_TO_COMMAND_FROM_STA == %STA_NR #THEN #BLOCK   
                              #SET STA'STA_NR':SCF = (10,%COMMAND_ADDRESS,0,0,1)
                              @LOG_SEND_TERM = 1
                           #BLOCK_END
                           #IF %ENABLE_LOGGING #THEN #BLOCK ; 8
                              @NCC_ADDR=%NCC_ADDRESSES(%NCC_COUNTER)
                              @NCC_TYPE=%NCC_SUBPROTOCOLS(%NCC_COUNTER)
                              @SH=%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER)
                              @S=STATUS
                              @INFO="'rt':'rm',USAI,'UN','LN':P'IX','STA_NR',,'AI',IEC 61850,'SH','NCC_ADDR','VALUE',,,'COT',,,,'QUALIFIER','S','OS',,'SX'"
                              #IF COM_LOG:CCS == 1 #THEN #DO COM_LOG:CCP
                              #ELSE #DO COM_LOG:CIN
                              #IF %LOG_SEND_TERM == 1 #THEN #BLOCK
                                 @CF_TIME = HR_CLOCK
                                 @CF_RT = TIMES(CF_TIME:VCL)
                                 @CF_RM = ROUND(CF_TIME:VUS/1000)
                                 @INFO="'CF_RT':'CF_RM',USAI,'STA_NR',,,Activation termination,,,,'COMMAND_ADDRESS',,,,,,,,,,,,"
                                 #IF COM_LOG:CCS == 1 #THEN #DO COM_LOG:CCP
                                 #ELSE #DO COM_LOG:CIN 
                              #BLOCK_END
                           #BLOCK_END ; 8                                                                                                
                        #BLOCK_END
                        #ELSE #BLOCK ;IEC 101/104 
                           ;protocol-specific parameters
                           @LOG_SEND_TERM = 0
                           @SEND_WITHOUT_TIME_TAG = TRUE
                           @SD_PRIORITY = 1
                           @EV_PRIORITY = 1
                           @SD_OVERWRITE = 0
                           #IF %SIGNAL_CLASSES(%NCC_COUNTER) == 0 #THEN #BLOCK
                              @SD_CLASS = 1 ; use default classes
                              @EV_CLASS = 1 
                           #BLOCK_END
                           #ELSE #BLOCK
                              @SD_CLASS = %SIGNAL_CLASSES(%NCC_COUNTER) ; use signal spes. classes                     
                              @EV_CLASS = %SIGNAL_CLASSES(%NCC_COUNTER)                        
                           #BLOCK_END
                           ;nt, iv and or bits of qualifier
                           #IF %OS == 2 #THEN @NT = 1
                           #ELSE @NT = 0
                           #IF %INDICATION_BLOCKED_ENABLED #THEN #BLOCK
                              #IF BIT(%RZ,3) == 1 #THEN @NT = 1
                           #BLOCK_END       
                           #IF %OS == 1 OR %OS == 10 #THEN @IV = 1
                           #ELSE @IV = 0
                           #IF %OS == 3 #THEN @IEC_CTRL = 1
                           #ELSE @IEC_CTRL = 0 
                           #IF %UTC_LOCAL_CONVERSION(%NCC_COUNTER) == 1 #THEN #BLOCK
                              @IEC_CTRL = BIT_SET(%IEC_CTRL,3)
                           #BLOCK_END     
                           #ELSE_IF %UTC_LOCAL_CONVERSION(%NCC_COUNTER) == 2 #THEN #BLOCK
                              @IEC_CTRL = BIT_SET(%IEC_CTRL,2)
                           #BLOCK_END              
                           #IF %SCALE_NAMES(%NCC_COUNTER) <> "" #THEN #block 
                              @SCALE_NAME = %SCALE_NAMES(%NCC_COUNTER)   
                              @i_Status = status
                              #error ignore
                                 @VALUE = SCALE(%AI,%SCALE_NAME,"INPUT")                                             
                              #error continue
                              #if status <> 0 #then #block
                                 @VALUE = %AI
                                 @IV = 1
                                 @i_Console = console_output("COM 500 scale 'SCALE_NAME' object not found. The update of signal 'LN':P'IX' is not scaled")
                                 @i_Status = status
                              #block_end
                           #block_end           
                           #ELSE @VALUE = %AI
                           #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),6) == 1 #THEN #BLOCK;send as Binary Input
                              #IF %VALUE <= 0 #THEN @VALUE = 0
                              #ELSE @VALUE = 1     
                           #BLOCK_END
                           #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),7) == 1 #THEN #BLOCK
                              #IF %VALUE > 63 #THEN #BLOCK 
                                 @VALUE = 63
                                 @OR = 1
                              #BLOCK_END 
                              #IF %VALUE < -64 #THEN #BLOCK 
                                 @VALUE = -64
                                 @OR = 1
                              #BLOCK_END
                              #IF %TRANSIENT_BIT == 1 #THEN #BLOCK
                                 #IF %VALUE >= 0 #THEN @VALUE = %VALUE + 128
                              #BLOCK_END
                              #ELSE #BLOCK
                                 #IF %VALUE < 0 #THEN @VALUE = %VALUE - 128
                              #BLOCK_END
                              @VALUE = ROUND(%VALUE)
                           #BLOCK_END
                           ;**************** project-specific modifications *************************
                           #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),0) == 1 #THEN #BLOCK
                              ;write the project-specific code in this block
                           #BLOCK_END
                           ;send value to NET according to the signal handling attributes
                           ;no time tag is sent at general interrogation or when sending requested data   
                           #IF (BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),1) == 1 OR BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),3) == 1 -
                             OR BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),5) == 1) AND NOT %INTERROGATED_OR_REQUESTED #THEN #BLOCK ;send with time tag ; 8
                              #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),2) == 1 #THEN #BLOCK ;send as short float ; 9
                                 #IF %NCC_SUBPROTOCOLS(%NCC_COUNTER) == 1 #THEN #BLOCK                      
                                    #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),1) == 1 #THEN @TYPE_ID =  "M_ME_TC_1" 
                                    #ELSE @TYPE_ID = "M_ME_TF_1" ;send with long time tag
                                 #BLOCK_END
                                 #ELSE #BLOCK
                                    #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),5) == 1 #THEN @TYPE_ID =  "M_ME_TF_1" ;send with long time tag
                                    #ELSE @TYPE_ID = "M_ME_TC_1"
                                 #BLOCK_END
                              #BLOCK_END ; 9
                              #ELSE_IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),7) == 1 #THEN #BLOCK ;Send as step position information
                                  #IF %NCC_SUBPROTOCOLS(%NCC_COUNTER) == 1 #THEN #BLOCK        
                                    #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),1) == 1 #THEN @TYPE_ID = "M_ST_TA_1" 
                                    #ELSE @TYPE_ID = "M_ST_TB_1" ;with long time tag 
                                  #BLOCK_END
                                  #ELSE #BLOCK
                                    #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),5) == 1 #THEN @TYPE_ID = "M_ST_TB_1" ;with long time tag
                                    #ELSE @TYPE_ID = "M_ST_TA_1" ;with time tag                                    
                                  #BLOCK_END
                              #BLOCK_END
                              #ELSE #BLOCK ; 9
                                 #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),4) == 1 #THEN #BLOCK
                                    #IF %NCC_SUBPROTOCOLS(%NCC_COUNTER) == 1 #THEN #BLOCK  
                                       #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),1) == 1 #THEN @TYPE_ID = "M_ME_TB_1" 
                                       #ELSE @TYPE_ID = "M_ME_TE_1" ;send as scaled value with long time tag 
                                    #BLOCK_END
                                    #ELSE #BLOCK                                 
                                       #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),5) == 1 #THEN @TYPE_ID = "M_ME_TE_1" ;send as scaled value with long time tag
                                       #ELSE @TYPE_ID = "M_ME_TB_1" ;send as scaled value with time tag                                  
                                    #BLOCK_END
                                 #BLOCK_END  
                                 #ELSE #BLOCK
                                    #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),5) == 1 #THEN #BLOCK 
                                       #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),6) == 1 #THEN @TYPE_ID = "M_SP_TB_1";send as Binary Input with long time tag
                                       #ELSE @TYPE_ID =  "M_ME_TD_1" ;send as normalized value with long time tag
                                    #BLOCK_END
                                    #ELSE #BLOCK
                                       #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),6) == 1 #THEN #BLOCK
                                          #IF %NCC_SUBPROTOCOLS(%NCC_COUNTER) == 1 #THEN #BLOCK  
                                             #IF (BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),1) == 1) #THEN @TYPE_ID = "M_SP_TA_1";send as Binary Input with time tag
                                             #ELSE @TYPE_ID = "M_SP_TB_1" ;send as Binary Input with long time tag
                                          #BLOCK_END
                                          #ELSE @TYPE_ID = "M_SP_TA_1";send as Binary Input with time tag
                                       #BLOCK_END
                                       #ELSE #BLOCK ;                                    
                                          #IF %NCC_SUBPROTOCOLS(%NCC_COUNTER) == 1 #THEN #BLOCK  
                                             #IF (BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),1) == 1) #THEN @TYPE_ID = "M_ME_TA_1";send as normalized value
                                             #ELSE @TYPE_ID =  "M_ME_TD_1" ;send as normalized value with long time tag
                                          #BLOCK_END
                                          #ELSE @TYPE_ID = "M_ME_TA_1" ;send as normalized value 
                                       #BLOCK_END
                                    #BLOCK_END                                   
                                 #BLOCK_END
                                 ;remove possible scaling overflows
                                 #IF TRUNC(%VALUE) == 32767 AND %SCALE_NAME <> "1_1" #THEN @VALUE = ROUND(%VALUE)
                                 ;if outside S16 range, limit value and set overflow bit
                                 #IF %VALUE > 32767 OR %VALUE < -32768 #THEN #BLOCK
                                    @VALUE = ROUND(MIN(MAX(%VALUE,-32768),32767))
                                    @OR = 1
                                 #BLOCK_END
                                 #ELSE @VALUE = ROUND(%VALUE)                          
                              #BLOCK_END ; 9
                              @QUALIFIER = %OR+2*0+4*0+8*0+16*%BL+32*%SB+64*%NT+128*%IV      
                              #SET STA'STA_NR':SEV(%EV_CLASS) = (%TYPE_ID,%NCC_ADDRESSES(%NCC_COUNTER),%VALUE,%COT,%QUALIFIER,%EV_PRIORITY,%RT,%RM,%IEC_CTRL)
                              #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),3) == 0 #THEN @SEND_WITHOUT_TIME_TAG = FALSE ; not also with time tag
                           #BLOCK_END ; 8 
                           #IF %SEND_WITHOUT_TIME_TAG #THEN #BLOCK ;send without time tag
                              #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),2) == 1 #THEN #BLOCK ;send as short float ; 9 
                                 @TYPE_ID =  "M_ME_NC_1"
                              #BLOCK_END ; 9
                              #ELSE_IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),6) == 1 #THEN @TYPE_ID = "M_SP_NA_1";Send as Binary Input ; 9
                              #ELSE_IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),7) == 1 #THEN @TYPE_ID = "M_ST_NA_1";Send as step position information                      
                              #ELSE #BLOCK ; 9
                                 #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),4) == 1 #THEN @TYPE_ID =  "M_ME_NB_1" ;send as scaled value
                                 #ELSE @TYPE_ID =  "M_ME_NA_1" ;send as normalized value
                                 ;if outside S16 range, limit value and set overflow bit
                                 #IF ABS(%VALUE) > 32767 #THEN #BLOCK ; 10                                                        
                                    @VALUE = ROUND(MIN(MAX(%VALUE,-32767),32767))
                                    @OR = 1
                                 #BLOCK_END ; 10
                                 #ELSE @VALUE = ROUND(%VALUE)                          
                              #BLOCK_END ; 9
                              @QUALIFIER = %OR+2*0+4*0+8*0+16*%BL+32*%SB+64*%NT+128*%IV      
                              #SET STA'STA_NR':SSD(%SD_CLASS) = (%TYPE_ID,%NCC_ADDRESSES(%NCC_COUNTER),%VALUE,%COT,%QUALIFIER,%SD_PRIORITY,%SD_OVERWRITE)
                           #BLOCK_END ; 8
                           ;if connected to a command and manual confirmation, terminate the command 
                           #IF %CONNECTED_TO_COMMAND_FROM_STA == %STA_NR #THEN #BLOCK   
                              #IF  STA'STA_NR':SPC == 0 AND %IEC_TERM_ENABLED #THEN #BLOCK
                                 #SET STA'STA_NR':SCF = (256*%ORIGINATOR+10,%COMMAND_ADDRESS)  
                                 @LOG_SEND_TERM = 1  
                              #BLOCK_END
                           #BLOCK_END
                           #IF %ENABLE_LOGGING #THEN #BLOCK ; 8
                              @NCC_ADDR=%NCC_ADDRESSES(%NCC_COUNTER)
                              @NCC_TYPE=%NCC_SUBPROTOCOLS(%NCC_COUNTER)
                              @SH=%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER)
                              @S=STATUS
                              #IF %NCC_TYPE == 0 #THEN @NCC_TYPE = "IEC101"
                              #ELSE @NCC_TYPE = "IEC104" 
                              #IF %SEND_WITHOUT_TIME_TAG #THEN @DATA_CLASS = %SD_CLASS
                              #ELSE @DATA_CLASS = %EV_CLASS                         
                              @INFO="'rt':'rm',USAI,'UN','LN':P'IX','STA_NR',,'AI','NCC_TYPE','SH','NCC_ADDR','VALUE',,'TYPE_ID','COT',,,,'QUALIFIER','S','OS','DATA_CLASS','SX'"
                              #IF COM_LOG:CCS == 1 #THEN #DO COM_LOG:CCP
                              #ELSE #DO COM_LOG:CIN
                              #IF %LOG_SEND_TERM == 1 #THEN #BLOCK
                                 @CF_TIME = HR_CLOCK
                                 @CF_RT = TIMES(CF_TIME:VCL)
                                 @CF_RM = ROUND(CF_TIME:VUS/1000)
                                 @INFO="'CF_RT':'CF_RM',USAI,'STA_NR',,,Activation termination,,,,'COMMAND_ADDRESS',,,,,,,,,,,,"
                                 #IF COM_LOG:CCS == 1 #THEN #DO COM_LOG:CCP
                                 #ELSE #DO COM_LOG:CIN 
                              #BLOCK_END
                           #BLOCK_END ; 8                                        
                        #BLOCK_END ; 7  
                     #BLOCK_END 
                     #WHEN 3 #BLOCK ;********************** CPI (attribute interface as in RP-570 slave) ***********************************************; 7   
                        #IF %SCALE_NAMES(%NCC_COUNTER) <> "" #THEN #block 
                           @SCALE_NAME = %SCALE_NAMES(%NCC_COUNTER)   
                           @i_Status = status
                           #error ignore
                              @VALUE = SCALE(%AI,%SCALE_NAME,"INPUT")                                             
                           #error continue
                           #if status <> 0 #then #block
                              @i_Console = console_output("COM 500 scale 'SCALE_NAME' object not found. The update of signal 'LN':P'IX' is not scaled")
                              @i_Status = status
                           #block_end
                        #block_end           
                        #ELSE @VALUE = %AI
   
                        ;check status and outside range, limit value with CPI/CDC-2
                        #IF ABS(%VALUE) > 2000 AND %NCC_SUBPROTOCOLS(%NCC_COUNTER)<>2 #THEN #BLOCK                        
                           @VALUE = ROUND(MIN(MAX(%VALUE,-2000),2000))
                           @LIMIT_INFO = 7
                           @STATUS = 7 
                        #BLOCK_END
                        #ELSE_IF (%OS <> 0 OR %OR==1) AND %NCC_SUBPROTOCOLS(%NCC_COUNTER)<>2 #THEN #BLOCK
                           @LIMIT_INFO = 7
                           @STATUS = 7
                        #BLOCK_END              
                        #ELSE #BLOCK
                           @LIMIT_INFO = 0   
                           @STATUS = 0
                        #BLOCK_END
                        #IF %INDICATION_BLOCKED_ENABLED #THEN #BLOCK
                           #IF BIT(%RZ,3) == 1 AND %NCC_SUBPROTOCOLS(%NCC_COUNTER)<>2 #THEN @STATUS = 7
                        #BLOCK_END
                        ;**************** project-specific modifications ************************
                        #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),0) == 1 #THEN #BLOCK
                           ;write the project-specific code in this block
                        #BLOCK_END
                        ;send value to NET
                        #CASE %NCC_SUBPROTOCOLS(%NCC_COUNTER) 
                           #WHEN 0 #BLOCK ;standard CPI
                              #SET STA'STA_NR':SAV(%NCC_ADDRESSES(%NCC_COUNTER)) = (RTU_ATIME(%RT,%RM),ROUND(%VALUE),%STATUS)
                              ;send ERMx telegram if required
                              #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),1) == 1 AND NOT %INTERROGATED_OR_REQUESTED #THEN -
                              #SET STA'STA_NR':SEX(%NCC_ADDRESSES(%NCC_COUNTER)) = (33,RTU_ATIME(%RT,%RM),0,%LIMIT_INFO)                                                                
                           #BLOCK_END
                           #WHEN 1 #BLOCK ;cdc-II
                              #IF (0 <> %ADDITIONAL_DATA(%NCC_COUNTER) ) #THEN #BLOCK
                                 #IF (0 == (%ADDITIONAL_DATA(%NCC_COUNTER) DIV 10000) ) #THEN #BLOCK
                                    @IDX= (3 * (%ADDITIONAL_DATA(%NCC_COUNTER) DIV 100)) + 130
                                    @IDX= %IDX + (%ADDITIONAL_DATA(%NCC_COUNTER) MOD 100 - 1) DIV 16
                                    @BIT= ((%ADDITIONAL_DATA(%NCC_COUNTER) MOD 100) - 1) MOD 16
                                 #BLOCK_END
                                 #ELSE #BLOCK
                                    @IDX= (%ADDITIONAL_DATA(%NCC_COUNTER) MOD 10000) DIV 100 + 96
                                    @BIT= (%ADDITIONAL_DATA(%NCC_COUNTER) MOD 100) - 1
                                 #BLOCK_END
                                 #IF (0 == %VALUE) #THEN #BLOCK
                                    #SET STA'STA_NR':SID(%IDX) = (RTU_ATIME(%RT,%RM),%BIT,0,%STATUS,0);
                                 #BLOCK_END
                                 #ELSE #BLOCK
                                    #SET STA'STA_NR':SID(%IDX) = (RTU_ATIME(%RT,%RM),%BIT,1,%STATUS,0);
                                 #BLOCK_END
                              #BLOCK_END
                              #SET STA'STA_NR':SAV(%NCC_ADDRESSES(%NCC_COUNTER)) = (RTU_ATIME(%RT,%RM),ROUND(%VALUE),%STATUS)          
                           #BLOCK_END  
                           #WHEN 2 #BLOCK ;modbus slave
                              #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),1) == 1 #THEN @VALUE = HEX_SCAN(RTU_HEXASC(RTU_AREAL(%VALUE)))  
                              #SET STA'STA_NR':SAV(%NCC_ADDRESSES(%NCC_COUNTER)) = (RTU_ATIME(%RT,%RM),ROUND(%VALUE),%STATUS)   
                           #BLOCK_END
                        #CASE_END
                        #IF %ENABLE_LOGGING #THEN #BLOCK ; 8
                           #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),1) == 1 #THEN @VALUE = %AI
                           @NCC_ADDR=%NCC_ADDRESSES(%NCC_COUNTER)
                           @NCC_TYPE=%NCC_SUBPROTOCOLS(%NCC_COUNTER)
                           @SH=%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER)
                           @S=STATUS
                           #IF %NCC_TYPE == 0 #THEN @NCC_TYPE = "CPI"
                           #ELSE_IF %NCC_TYPE == 1 #THEN @NCC_TYPE = "CDC-2"
                           #ELSE @NCC_TYPE = "MODBUS"
                           @INFO="'rt':'rm',USAI,'UN','LN':P'IX','STA_NR',,'AI','NCC_TYPE','SH','NCC_ADDR','VALUE','LIMIT_INFO',,,,,,'status','S','OS',,'SX'"
                           #IF COM_LOG:CCS == 1 #THEN #DO COM_LOG:CCP
                           #ELSE #DO COM_LOG:CIN
                        #BLOCK_END ; 8                                          
                     #BLOCK_END ; 7
                     #WHEN 4 #BLOCK ; ********************** DNP 3.0 slave ****************************************************************************; 7 
                        ;protocol parameters 
                        @SD_CLASS = 2 ; middle weight (priority)
                        #IF %SIGNAL_CLASSES(%NCC_COUNTER) == 0 #THEN #BLOCK
                           @EV_CLASS = 0 ; use default event class
                        #BLOCK_END
                        #ELSE @EV_CLASS = %SIGNAL_CLASSES(%NCC_COUNTER) ; use signal spes. class
                        @DELTA = 0
                        @EV_CTRL = 0 
                        #IF %COT == 3 + 256*%OG AND %INTERROGATED_OR_REQUESTED == TRUE #THEN @INTERROGATED_OR_REQUESTED = FALSE
                        
                        @SCALE_FAILED = FALSE
                        #IF %SCALE_NAMES(%NCC_COUNTER) <> "" #THEN #block 
                           @SCALE_NAME = %SCALE_NAMES(%NCC_COUNTER)   
                           @i_Status = status
                           #error ignore
                              @VALUE = SCALE(%AI,%SCALE_NAME,"INPUT")                                             
                           #error continue
                           #if status <> 0 #then #block
                              @VALUE = %AI
                              @SCALE_FAILED = TRUE
                              @i_Console = console_output("COM 500 scale 'SCALE_NAME' object not found. The update of signal 'LN':P'IX' is not scaled")
                              @i_Status = status
                           #block_end
                        #block_end           
                        #ELSE @VALUE = %AI
   
                        ;group and variation of the object 
                        #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),6) == 1 #THEN #BLOCK ;send as Binary Input
                           #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),3) == 1 AND NOT %INTERROGATED_OR_REQUESTED AND STA'STA_NR':SDI == 1 #THEN @OBJ_VAR = (2,1) ; send change event without time                         
                           #ELSE_IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),5) == 1 AND NOT %INTERROGATED_OR_REQUESTED AND STA'STA_NR':SDI == 1 #THEN @OBJ_VAR = (2,2) ; send change event with time                         
                           #ELSE @OBJ_VAR = (1,1) ;send as Binary Input
                           #IF %VALUE <= 0 #THEN @VALUE = 0
                           #ELSE @VALUE = 1     
                        #BLOCK_END
                        #ELSE_IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),1) == 1 #THEN #BLOCK ; send as 16-bit value                                
                           #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),2) == 1 #THEN @OBJ_VAR = (30,4) ; send without flag
                           #ELSE_IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),3) == 1 AND NOT %INTERROGATED_OR_REQUESTED AND STA'STA_NR':SDI == 1 #THEN @OBJ_VAR = (32,2) ; send change event without time 
                           #ELSE_IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),5) == 1 AND NOT %INTERROGATED_OR_REQUESTED AND STA'STA_NR':SDI == 1 #THEN @OBJ_VAR = (32,4) ; send change event with time                         
                           #ELSE @OBJ_VAR = (30,2) ; send as 16-bit analog value
                           ;remove possible scaling overflows
                           #IF TRUNC(%VALUE) == 32767 AND %SCALE_NAME <> "1_1" #THEN @VALUE = ROUND(%VALUE)
                           ;if outside S16 range, limit value and set overflow bit
                           #IF ABS(%VALUE) > 32767 #THEN #BLOCK ; 9
                              @VALUE = ROUND(MIN(MAX(%VALUE,-32767),32767))
                              @OR = 1
                           #BLOCK_END ; 9
                           #ELSE @VALUE = ROUND(%VALUE)                                                                         
                        #BLOCK_END  
                        #ELSE_IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),7) == 1 #THEN #BLOCK ; send as float 
                          #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),3) == 1 AND NOT %INTERROGATED_OR_REQUESTED AND STA'STA_NR':SDI == 1 #THEN @OBJ_VAR = (32,5) ; send change event without time
                          #ELSE_IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),5) == 1 AND NOT %INTERROGATED_OR_REQUESTED AND STA'STA_NR':SDI == 1 #THEN @OBJ_VAR = (32,7) ; send change event with time
                          #ELSE @OBJ_VAR = (30,5) ; send as float with flag
                        #BLOCK_END
                        #ELSE #BLOCK ; send as 32-bit value      
                           #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),2) == 1 #THEN @OBJ_VAR = (30,3) ; send without flag
                           #ELSE_IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),3) == 1 AND NOT %INTERROGATED_OR_REQUESTED AND STA'STA_NR':SDI == 1 #THEN @OBJ_VAR = (32,1) ; send change event without time 
                           #ELSE_IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),5) == 1 AND NOT %INTERROGATED_OR_REQUESTED AND STA'STA_NR':SDI == 1 #THEN @OBJ_VAR = (32,3) ; send change event with time 
                           #ELSE @OBJ_VAR = (30,1) ; send as 32-bit analog value   
                           @VALUE = ROUND(%VALUE)                                                  
                        #BLOCK_END
                        ;compose control byte
                        #CASE %NCC_OPERATION_MODES(%NCC_COUNTER)
                           #WHEN 1 @CTRL = 7  ; quiescent mode                     
                           #WHEN 2 @CTRL = 3  ; unsolicited report-by-exception mode
                           #WHEN 3 @CTRL = 1  ; polled report-by-exception mode
                           #WHEN 4 @CTRL = 1  ; polled static mode                        
                        #CASE_END  
                        ;compose flag byte
                        #IF %OS == 2 #THEN @COMM_LOST = 1
                        #ELSE @COMM_LOST = 0
                        #IF %OS == 1 OR %OS == 10 OR %OS == 2 #THEN @ON_LINE = 0
                        #ELSE @ON_LINE = 1 
                        #IF %SCALE_FAILED #THEN @ON_LINE = 0 
                         #IF %INDICATION_BLOCKED_ENABLED #THEN #BLOCK
                           #IF BIT(%RZ,3) == 1 #THEN @ON_LINE = 0
                        #BLOCK_END 
                        @FLAG = %ON_LINE+0*2+%COMM_LOST*4+0*8+%SB*16+%OR*32+0*64+0*128              
                        #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),4) == 1 #THEN #BLOCK ; send every EV writing to master
                           @EV_CTRL = 1
                        #BLOCK_END
                        #IF %UTC_LOCAL_CONVERSION(%NCC_COUNTER) == 1 #THEN #BLOCK
                           @EV_CTRL = BIT_SET(%EV_CTRL,1)
                        #BLOCK_END
                        ;**************** project-specific modifications *************************
                        #IF BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),0) == 1 #THEN #BLOCK
                           ;write the project-specific code in this block
                        #BLOCK_END
                        ;send value to NET 
                        #IF NOT %INTERROGATED_OR_REQUESTED #THEN #BLOCK
                           #IF (BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),3) == 1  OR BIT(%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER),5) == 1) AND STA'STA_NR':SDI == 1 #THEN -
                           #SET STA'STA_NR':SEV(%EV_CLASS) = (%OBJ_VAR(1),%OBJ_VAR(2),%NCC_ADDRESSES(%NCC_COUNTER),%VALUE,%FLAG,%DELTA,%RT,%RM,%EV_CTRL) ; send change event without time                 
                           #ELSE #SET STA'STA_NR':SSD(%SD_CLASS) = (%OBJ_VAR(1),%OBJ_VAR(2),%NCC_ADDRESSES(%NCC_COUNTER),%VALUE,%FLAG,%CTRL)
                        #BLOCK_END
                        #ELSE #SET STA'STA_NR':SSD(%SD_CLASS) = (%OBJ_VAR(1),%OBJ_VAR(2),%NCC_ADDRESSES(%NCC_COUNTER),%VALUE,%FLAG,%CTRL)
                        #IF %ENABLE_LOGGING #THEN #BLOCK ; 8
                           @SH=%SIGNAL_HANDLING_ATTRS(%NCC_COUNTER)
                           @OBJ=%OBJ_VAR(1)
                           @VAR=%OBJ_VAR(2)
                           @NCC_ADDR=%NCC_ADDRESSES(%NCC_COUNTER)
                           @S=STATUS
                           #IF %EV_CLASS == 0 #THEN @DATA_CLASS = %SD_CLASS
                           #ELSE @DATA_CLASS = %EV_CLASS 
                           @INFO="'rt':'rm',USAI,'UN','LN':P'IX','STA_NR',,'AI',DNP30,'SH','NCC_ADDR','VALUE',,,,'OBJ','VAR','FLAG','CTRL','S','OS','DATA_CLASS','SX'"
                           #IF COM_LOG:CCS == 1 #THEN #DO COM_LOG:CCP
                           #ELSE #DO COM_LOG:CIN
                        #BLOCK_END ; 8
                     #BLOCK_END ; 7                            
                  #CASE_END ; 6
               #BLOCK_END ; 5
               #ELSE_IF %ENABLE_LOGGING #THEN #BLOCK ; 5
                  #IF %NCC_ADDRESSES(%NCC_COUNTER) <> -1 #THEN @NCC_ADDR_FOUND = TRUE
                  #ELSE @NCC_ADDR_FOUND = FALSE
                  @DISABLE_NCC_DATA=COM_GENVAR:PBZ(%NCC_NUMBER+4)
                  @INFO="'rt':'rm',USAI,'UN','LN':P'IX','STA_NR',ncc addr found:'NCC_ADDR_FOUND' disable ncc data sending:'DISABLE_NCC_DATA',,,,,,,,,,,,,,,,"
                  #IF COM_LOG:CCS == 1 #THEN #DO COM_LOG:CCP
                  #ELSE #DO COM_LOG:CIN
               #BLOCK_END ; 5                        
               ;if group alarm information found and alarm state changed, set to the group/bit
               #IF %AL_GROUP > 0 AND %AL_BIT > 0 #THEN #BLOCK ; 5
                  #IF %AL <> BIT(BNCC'NCC_NUMBER'_GRP:POV'AL_GROUP',%AL_BIT) #THEN #BLOCK ; 6
                     #IF %AL == 1 #THEN #BLOCK ; 7
                        @SEND_ALARM_GROUP_ALWAYS_WHEN_ALARMING = BIT(BNCC'NCC_NUMBER'_GRP:PFI'AL_GROUP',3)
                        #IF %SEND_ALARM_GROUP_ALWAYS_WHEN_ALARMING == 1 #THEN #BLOCK
                           #SET BNCC'NCC_NUMBER'_GRP:PRI'AL_GROUP' = BNCC'NCC_NUMBER'_GRP:PRI'AL_GROUP'+2
                        #BLOCK_END
                        #SET BNCC'NCC_NUMBER'_GRP:POV'AL_GROUP' = LIST(OV=BIT_SET(BNCC'NCC_NUMBER'_GRP:POV'AL_GROUP',%AL_BIT),RT=%RT,RM=%RM)
                        @PULSE_GROUP = (BIT(BNCC'NCC_NUMBER'_GRP:PFI'AL_GROUP',1)==1)
                        ; if group alarm is sent as pulse, send also immediteally resetting value
                        #IF %PULSE_GROUP #THEN #BLOCK
                           #IF 'LN':PAR'IX'==0 #THEN #SET BNCC'NCC_NUMBER'_GRP:POV'AL_GROUP' = LIST(OV=BIT_CLEAR(BNCC'NCC_NUMBER'_GRP:POV'AL_GROUP',%AL_BIT),RT=%RT,RM=%RM)
                        #BLOCK_END 
                     #BLOCK_END ; 7
                     #ELSE #SET BNCC'NCC_NUMBER'_GRP:POV'AL_GROUP' = LIST(OV=BIT_CLEAR(BNCC'NCC_NUMBER'_GRP:POV'AL_GROUP',%AL_BIT),RT=%RT,RM=%RM)
                  #BLOCK_END ; 6
               #BLOCK_END ; 5
            #LOOP_END ; 4
         #BLOCK_END ; 4   
      #BLOCK_END ; 3
      #ELSE_IF %ENABLE_LOGGING #THEN #BLOCK
         @INFO="'rt':'rm',USAI,'UN','LN':P'IX',,ncc connection not found,,,,,,,,,,,,,,,,"
         #IF COM_LOG:CCS == 1 #THEN #DO COM_LOG:CCP
         #ELSE #DO COM_LOG:CIN
      #BLOCK_END
   #BLOCK_END ; 2
   #ELSE_IF %ENABLE_LOGGING #THEN #BLOCK
      @INFO="'rt':'rm',USAI,'UN','LN':P'IX',,cross-reference not found,,,,,,,,,,,,,,,,"
      #IF COM_LOG:CCS == 1 #THEN #DO COM_LOG:CCP
      #ELSE #DO COM_LOG:CIN
   #BLOCK_END     
#BLOCK_END ; 1
#ELSE_IF %ENABLE_LOGGING #THEN #BLOCK
   @INFO="'rt':'rm',USAI,'UN','LN':P'IX',,prevent_sending:'PREVENT_DATA_SENDING' enable_sending_after_startup:'ENABLE_DATA_SENDING_AFTER_STARTUP',,,,,,,,,,,,,,,,"
   #IF COM_LOG:CCS == 1 #THEN #DO COM_LOG:CCP
   #ELSE #DO COM_LOG:CIN
#BLOCK_END    


